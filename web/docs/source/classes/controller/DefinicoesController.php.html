<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php 
/**
 * @author Jefferson Uchoa Ponte
 * @version 1.0
 * @copyright UNILAB - Universidade da Integracao Internacional da Lusofonia Afro-Brasileira.
 * @package Controle
 */

	class DefinicoesController {
	
		private $view;
		private $dao;
	
		public static function main($nivelDeAcesso) {
			switch ($nivelDeAcesso) {
				case Sessao::NIVEL_SUPER :
					$controller = new DefinicoesController ();
					$controller-&gt;telaDefinicoes ();
					break;
				case Sessao::NIVEL_ADMIN:
					$controller = new DefinicoesController ();
					$controller-&gt;telaDefinicoes ();
					break;
				default :
					UsuarioController::main ( $nivelDeAcesso );
					break;
			}
		}
	
		public function telaConfiguracaoUnidadeAcademica() {
			$this-&gt;view-&gt;formInserirUnidade ();
			$unidadeDao = new UnidadeDAO ( $this-&gt;dao-&gt;getConexao () );
			if (isset ( $_GET ['cadastrar_unidade'] )) {
				if (strlen( $_GET ['cadastrar_unidade'] ) &gt; 3) {
					echo '&lt;div class=&quot;borda&quot;&gt;';
					$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;,&quot;Deseja adicionar: &quot;.$_GET ['cadastrar_unidade'] .&quot;?&quot;);
					echo '	&lt;form action=&quot;&quot; method=&quot;post&quot; class=&quot;formulario sequencial texto-preto&quot;&gt;
							&lt;input type=&quot;hidden&quot; name=&quot;certeza_cadastrar_unidade&quot; value=&quot;' . $_GET ['cadastrar_unidade'] . '&quot; /&gt;
							&lt;input  type=&quot;submit&quot;  name=&quot;certeza&quot; value=&quot;Confirmar&quot;/&gt;
					&lt;/form&gt;
					&lt;/div&gt;';
				}
				
	
			}
			
			
			if (isset ( $_POST ['certeza_cadastrar_unidade'] )) {
				if (strlen( $_GET ['cadastrar_unidade'] ) &gt; 3) {

					$unidade = $_POST ['certeza_cadastrar_unidade'];
					$i = 0;
					$sql = &quot;SELECT * FROM unidade WHERE unid_nome = '$unidade'&quot;;
					$result = $this-&gt;dao-&gt;getConexao()-&gt;query($sql);
					foreach ($result as $linha){
						$i++;
					}
					if ($i == 0){
						$stmt = $this-&gt;dao-&gt;getConexao()-&gt;prepare(&quot;INSERT INTO unidade(unid_nome) VALUES(?);&quot;);
						$stmt-&gt;bindParam(1, $unidade);
						if ($stmt-&gt;execute()) {
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Unidade inserida com sucesso!&quot;);
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&amp;&quot;&gt;';
						} else {
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao inseriri a unidade!&quot;);
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						}
					}else{
						$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Unidade j&aacute; cadastrada!&quot;);
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
					}
					return;
				}
					
			} else {
				$unidadesAcademicas = $unidadeDao-&gt;retornaLista ();
				foreach ($unidadesAcademicas as $unidadeAcademica){
					$unidadeDao-&gt;turnosDaUnidade($unidadeAcademica);
	
				}
				$this-&gt;view-&gt;listarUnidadesAcademicas ( $unidadesAcademicas );
					
				if (isset ( $_GET ['turno_na_unidade'] )) {
					$unidade = new Unidade ();
					$unidade-&gt;setId ( $_GET ['turno_na_unidade'] );
					$unidadeDao-&gt;preenchePorId($unidade);
	
					$turnoDao = new TurnoDAO ( $unidadeDao-&gt;getConexao () );
	
					$listaDeTurnos = $turnoDao-&gt;retornaLista ();
					$this-&gt;view-&gt;formTurnoNaUnidade($unidade, $listaDeTurnos);
					if(isset($_POST['turno_na_unidade'])){
						$turno = new Turno();
						$unidade = new Unidade();
						$turno-&gt;setId($_POST['id_turno']);
						$unidade-&gt;setId($_POST['id_unidade']);
						if($unidadeDao-&gt;turnoNaUnidade($turno, $unidade))
							$this-&gt;view-&gt;mostraSucesso(&quot;Turno Adicionado com Sucesso&quot;);
							else
								$this-&gt;view-&gt;mostraSucesso(&quot;Erro ao tentar adicionar turno na Unidade&quot;);
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&quot;&gt;';
									
					}
				}
					
				else if(isset($_GET['excluir_turno_da_unidade'])){
					$unidade = new Unidade ();
					$unidade-&gt;setId ( $_GET ['excluir_turno_da_unidade'] );
					$unidadeDao-&gt;preenchePorId($unidade);
					$unidadeDao-&gt;turnosDaUnidade($unidade);
	
					$turnoDao = new TurnoDAO ( $unidadeDao-&gt;getConexao () );
	
					$listaDeTurnos = $turnoDao-&gt;retornaLista ();
					$this-&gt;view-&gt;formExcluirTurnoDaUnidade($unidade);
					if(isset($_POST['excluir_turno_da_unidade'])){
						$turno = new Turno();
						$unidade = new Unidade();
						$turno-&gt;setId($_POST['id_turno']);
						$unidade-&gt;setId($_POST['id_unidade']);
						if($unidadeDao-&gt;excluirTurnoDaUnidade($turno, $unidade))
							$this-&gt;view-&gt;mostraSucesso(&quot;Turno exclu&iacute;do com Sucesso&quot;);
							else
								$this-&gt;view-&gt;mostraSucesso(&quot;Erro ao tentar excluir turno na Unidade&quot;);
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&quot;&gt;';
	
					}
	
				}
			}
	
			// $this-&gt;view-&gt;formAdicionarTurnoNaUnidade();
		}
	
		public function telaCatracas(){
	
			$dao = new DAO();
			$this-&gt;view-&gt;formAdicionarCatracaVirtual();
	
			if(isset($_GET['nome_catraca'])){
				if(strlen($_GET['nome_catraca']) &lt; 3){
					echo '&lt;div class=&quot;borda&quot;&gt;';
					$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Insira um nome maior&quot;);
					echo '&lt;/div&gt;';
					echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&amp;lista_catracas=1&quot;&gt;';
					return;
				}
				$nomeCatraca = $_GET['nome_catraca'];
				$sql1 = &quot;SELECT * FROM catraca WHERE catr_nome = '$nomeCatraca'&quot;;
				$result = $dao-&gt;getConexao()-&gt;query($sql1);
				$i = 0;
	
				foreach ($result as $linha){
					$i++;
				}
	
				if($i &gt; 0){
					$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Esta catraca j&aacute; existe!&quot;);
					echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
				}else{
					if(isset($_POST['confirmar'])){
						$sql = &quot;INSERT INTO catraca (catr_nome) VALUES ('$nomeCatraca')&quot;;
						if($dao-&gt;getConexao()-&gt;exec($sql)){
							echo'&lt;div class=&quot;borda&quot;&gt;';
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Catraca adicionada com Sucesso!&quot;);
							echo '&lt;/div&gt;';
						}else{
							echo'&lt;div class=&quot;borda&quot;&gt;';
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;N&atilde;o foi poss&iacute;vel adicionar a catraca!&quot;);
							echo '&lt;/div&gt;';
						}
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						return ;
					}
	
					echo '&lt;div class=&quot;borda&quot;&gt;';
					$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Tem certeza que deseja adicionar esta catraca? &quot;.$_GET['nome_catraca']);
					echo '&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
						&lt;input type=&quot;hidden&quot; value=&quot;'.$_GET['nome_catraca'].'&quot; name=&quot;nome_catraca&quot;&gt;
						&lt;input type=&quot;submit&quot; class=&quot;botao&quot; value=&quot;Confirmar&quot; name=&quot;confirmar&quot; /&gt;
						&lt;/form&gt;';
					echo '&lt;/div&gt;';
				}
			}
	
			$unidadeDao = new UnidadeDAO($this-&gt;dao-&gt;getConexao());
			$listaDeCatracas = $unidadeDao-&gt;retornaCatracasPorUnidade();
			$this-&gt;view-&gt;listarCatracas($listaDeCatracas);
	
	
			if(isset($_GET['editar_catraca'])){
				$id  = intval($_GET['editar_catraca']);
				if(!$id){
					$this-&gt;view-&gt;mostraSucesso(&quot;Erro ao tentar editar catraca&quot;);
					echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&amp;lista_catracas=1&quot;&gt;';
					return;
				}
				$catraca = new Catraca();
				$catraca-&gt;setId($_GET['editar_catraca']);
				$listaDeUnidades = $unidadeDao-&gt;retornaLista();
					
				$unidadeDao-&gt;preencheCatracaPorId($catraca);
					
				$this-&gt;view-&gt;formEditarCatraca($catraca, $listaDeUnidades);
					
				if(isset($_POST['salvar'])){
					$catraca-&gt;setId($_POST['id_catraca']);
					$catraca-&gt;setNome($_POST['nome_catraca']);
					$catraca-&gt;setOperacao($_POST['operacao']);
					$catraca-&gt;setTempoDeGiro($_POST['tempo_giro']);
					$catraca-&gt;setInterfaceRede($_POST['interface']);
					$catraca-&gt;setUnidade(new Unidade());
					$catraca-&gt;getUnidade()-&gt;setId($_POST['id_unidade']);
					$catraca-&gt;setFinanceiro($_POST['financeiro']);
					if($unidadeDao-&gt;atualizarCatraca($catraca))
						$this-&gt;view-&gt;mostraSucesso(&quot;Catraca editada com sucesso&quot;);
						else
							$this-&gt;view-&gt;mostraSucesso(&quot;Erro ao tentar editar catraca&quot;);
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&amp;lista_catracas=1&quot;&gt;';
	
				}
			}
	
	
		}
		public function telaConfiguracaoDeTurnos() {
			$this-&gt;view-&gt;formAdicionarTurno ();
			$turnoDao = new TurnoDAO ( $this-&gt;dao-&gt;getConexao () );
	
			if (isset ( $_GET ['cadastrar_turno'] )) {
				if(strlen($_GET['turno_nome']) &lt; 3){
					$this-&gt;view-&gt;mostraSucesso ( &quot;Escreva Um Nome Maior&quot; );
					return;
				}
				if(strlen($_GET['hora_inicio']) &lt; 3){
					$this-&gt;view-&gt;mostraSucesso ( &quot;Digite a Hora de In&iacute;cio&quot; );
					return;
				}
				if(strlen($_GET['hora_fim']) &lt; 3){
					$this-&gt;view-&gt;mostraSucesso ( &quot;Digite a Hora de fim&quot; );
					return;
				}
				
				echo '	&lt;div class=&quot;borda&quot;&gt;';
				$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Voc&ecirc; tem certeza que quer adicionar esse turno? &quot;.$_GET ['turno_nome']);
				echo '	&lt;form action=&quot;&quot; method=&quot;post&quot; class=&quot;formulario sequencial texto-preto&quot;&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;hora_inicio&quot; value=&quot;' . $_GET ['hora_inicio'] . '&quot; /&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;hora_fim&quot; value=&quot;' . $_GET ['hora_fim'] . '&quot; /&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;turno_nome&quot; value=&quot;' . $_GET ['turno_nome'] . '&quot; /&gt;
						&lt;input  type=&quot;submit&quot;  name=&quot;certeza_cadastrar_turno&quot; value=&quot;Confirmar&quot;/&gt;
					&lt;/form&gt;
					&lt;/div&gt;';
				
			}
			
	
			if (isset ( $_POST ['certeza_cadastrar_turno'] )) {
				if(strlen($_GET['turno_nome']) &lt; 3){
					$this-&gt;view-&gt;mostraSucesso ( &quot;Escreva Um Nome Maior&quot; );
					return;
				}
				$turnoNome = $_POST ['turno_nome'];
					
				$horaInicio = $_POST ['hora_inicio'];
				$horaFim = $_POST ['hora_fim'];
					
				$stmt = $this-&gt;dao-&gt;getConexao()-&gt;prepare( &quot;INSERT INTO turno(turn_hora_inicio,turn_hora_fim,turn_descricao) VALUES(?, ?, ?);&quot;);
				$stmt-&gt;bindParam(1, $horaInicio);
				$stmt-&gt;bindParam(2, $horaFim);
				$stmt-&gt;bindParam(3, $turnoNome);
					
					
				if ($stmt-&gt;execute()) {
					$this-&gt;view-&gt;mostraSucesso ( &quot;Sucesso&quot; );
				} else {
					$this-&gt;view-&gt;mostraSucesso ( &quot;Erro ao tentar inserir unidade&quot; );
				}
				echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&quot;&gt;';
				return;
			} else {
				$turnos = $turnoDao-&gt;retornaLista ();
				$this-&gt;view-&gt;listarTurnos ( $turnos );
			}
	
			if (isset($_GET['editar'])){
				if (isset($_GET['id_turno'])){
					$dao = new TurnoDAO();
					$turno = new Turno();
					$turno-&gt;setId($_GET['id_turno']);
	
					$dao-&gt;retornaTurnoPorId($turno);
					$this-&gt;view-&gt;formEditarTurno($turno);
						
					if (isset($_POST['confirmar'])){
							
						$turno-&gt;setHoraInicial($_POST['hora_inicio']);
						$turno-&gt;setHoraFinal($_POST['hora_fim']);
							
						if ($dao-&gt;atualizaTurno($turno)){
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Turno alterado com sucesso!&quot;);
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						}else{
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao editar o turno.&quot;);
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						}
						return ;
					}
					return ;
				}
			}
	
			// $this-&gt;view-&gt;formAdicionarTurnoNaUnidade();
	
		}
	
		public function telaTiposDeUsuarios() {
			$this-&gt;view-&gt;formAdicionarTipoDeUsuario ();
			$tipoDao = new TipoDAO ( $this-&gt;dao-&gt;getConexao () );
	
			if (isset ( $_GET ['cadastrar_tipo'] )) {
				$tipo = $_GET ['tipo_nome'];
				echo '	&lt;div class=&quot;borda&quot;&gt;';
				$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Voc&ecirc; tem certeza que quer adicionar esse tipo de usu&aacute;rio? $tipo&quot;);
				echo '	&lt;form action=&quot;&quot; method=&quot;post&quot; class=&quot;formulario sequencial texto-preto&quot;&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;tipo_nome&quot; value=&quot;' . $_GET ['tipo_nome'] . '&quot; /&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;tipo_valor&quot; value=&quot;' . $_GET ['tipo_valor'] . '&quot; /&gt;
						&lt;input  type=&quot;submit&quot;  name=&quot;certeza_cadastrar_tipo&quot; value=&quot;Confirmar&quot;/&gt;
					&lt;/form&gt;';
				echo '	&lt;/div&gt;';
			}
			if (isset ( $_POST ['certeza_cadastrar_tipo'] )) {
				$tipoNome = $_POST ['tipo_nome'];
				$tipoValor = floatval ( $_POST ['tipo_valor'] );
				$stmt = $this-&gt;dao-&gt;getConexao()-&gt;prepare(&quot;INSERT INTO tipo(tipo_nome, tipo_valor) VALUES(?, ?);&quot;);
				$stmt-&gt;bindParam(1, $tipoNome);
				$stmt-&gt;bindParam(2, $tipoValor);
					
				if ($stmt-&gt;execute()) {
					$this-&gt;view-&gt;mostraSucesso ( &quot;Sucesso&quot; );
				} else {
					$this-&gt;view-&gt;mostraSucesso ( &quot;Erro ao tentar inserir unidade&quot; );
				}
				echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;4; url=.\?pagina=definicoes&quot;&gt;';
				return;
			} else {
				$tipos = $tipoDao-&gt;retornaLista ();
				$this-&gt;view-&gt;listarTiposDeUsuarios ( $tipos );
			}
	
			if (isset($_GET['editar_tipo'])){
				$tipo = new Tipo();
				$tipo-&gt;setId($_GET['editar_tipo']);
				$idTipo = $tipo-&gt;getId();
				$tipoDao-&gt;retornaTipoPorId($tipo);
				$this-&gt;view-&gt;formEditarTipo($tipo);
					
				if (isset($_POST['alterar'])){
	
					$novoValor = $_POST['valor_tipo'];
					$sql = &quot;UPDATE tipo SET tipo_valor=$novoValor WHERE tipo_id= $idTipo&quot;;
	
					if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
						$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Valor do &quot;.$tipo-&gt;getNome().&quot; foi alterado com sucesso!&quot;);
					}else{
						$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;N&atilde;o foi possivel altera o valor!&quot;);
					}
					echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
					return ;
				}
			}
		}
	
		public function telaDeCustos() {
			$custoAtualRefeicao = 0;
			$result = $this-&gt;dao-&gt;getConexao ()-&gt;query ( &quot;SELECT cure_valor FROM custo_refeicao ORDER BY cure_id DESC LIMIT 1 ;&quot; );
			foreach ( $result as $linha ) {
				$custoAtualRefeicao = $linha ['cure_valor'];
				break;
			}
	
			$custoCartao = 0;
			$result = $this-&gt;dao-&gt;getConexao ()-&gt;query ( &quot;SELECT cuca_valor  FROM custo_cartao ORDER BY cuca_id DESC LIMIT 1 ;&quot; );
			foreach ( $result as $linha ) {
				$custoCartao = $linha ['cuca_valor'];
				break;
			}
	
			$unidadeDao = new UnidadeDAO();
			$listaUnidade = $unidadeDao-&gt;retornaLista();
			$listaCusto = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * FROM custo_refeicao&quot;);
			$listaCustoUnidade = $unidadeDao-&gt;custosDaUnidade();
	
			$this-&gt;view-&gt;formAlterarCustoRefeicao ( $custoAtualRefeicao );
	
			$this-&gt;view-&gt;formAlterarCustoCartao ( $custoCartao );

			$this-&gt;view-&gt;formCustoUnidade($listaUnidade, $listaCusto);
	
			$this-&gt;view-&gt;listaCustoUnidade($listaCustoUnidade);
			
			if (isset ( $_GET ['custo_refeicao'] )) {
				if (isset($_POST['confirmar'])){
					$dataTimeAtual = date ( &quot;Y-m-d G:i:s&quot; );
					$valor = floatval ( $_GET ['custo_refeicao'] );
					$dao = new DAO();
					$i = 0;
					$sql = &quot;SELECT * FROM custo_refeicao  WHERE cure_valor = $valor&quot;;
					$result = $this-&gt;dao-&gt;getConexao()-&gt;query($sql);
					foreach ($result as $linha){
						$i++;
					}
					if($i==0){
						if ($this-&gt;dao-&gt;getConexao ()-&gt;exec ( &quot;INSERT into custo_refeicao(cure_valor, cure_data) VALUES($valor, '$dataTimeAtual')&quot; )){
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_custo=sucesso&quot;&gt;';
						}else{
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_custo=erro&quot;&gt;';
						}
					}else{
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_custo=erro&quot;&gt;';
					}
				}
			}
	
			if (isset ( $_GET ['custo_cartao'] )) {
				if (isset($_POST['confirmar'])){
					$dataTimeAtual = date ( &quot;Y-m-d G:i:s&quot; );
					$valor = floatval ( $_GET ['custo_cartao'] );
						
					if ($this-&gt;dao-&gt;getConexao ()-&gt;exec ( &quot;INSERT into custo_cartao(cuca_valor , cuca_data ) VALUES($valor, '$dataTimeAtual')&quot; ))
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_cartao=sucesso&quot;&gt;';
						else
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_cartao=erro&quot;&gt;';
								
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_cartao=erro&quot;&gt;';
				}
			}
	
	
			/*
			 * Inclui e altera o custo espec&iacute;fico da unidade.
			 */
			if (isset($_GET['unidade'])){
				
				if (isset($_GET['valor_custo'])){
					
					if (isset($_POST['confirmar'])){
						$idUnidade = $_GET['unidade'];
						$idValorCusto = $_GET['valor_custo'];
						$consulta = &quot;SELECT * FROM custo_unidade WHERE unid_id = $idUnidade&quot;;
						$result = $this-&gt;dao-&gt;getConexao()-&gt;query($consulta);
						$i = 0;
	
						foreach ($result as $linha){
							$i++;
						}
	
						if ($i == 0){
							$sql = &quot;INSERT INTO custo_unidade (unid_id, cure_id) VALUES ($idUnidade, $idValorCusto)&quot;;
							if($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_unidade=sucesso&quot;&gt;';
							}else{
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_unidade=erro&quot;&gt;';
							}
							return ;
						}else{
							$sql = &quot;UPDATE custo_unidade SET cure_id = $idValorCusto WHERE unid_id = $idUnidade&quot;;
							if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_unidade=alterado&quot;&gt;';
							}else{
								echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=.\?pagina=definicoes&amp;info_unidade=erro&quot;&gt;';
							}
							return ;
						}
					}
				}
			}
	
			if (isset($_GET['excluir'])){
				if (isset($_POST['confirmar'])){
					$idValorCusto = $_GET['custo_unidade_id'];
					$sql=&quot;DELETE FROM custo_unidade WHERE unid_id = $idValorCusto&quot;;
					if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
						$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Custo removido com sucesso!&quot;);
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
					}else{
						$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao Excluir o custo da unidade!&quot;);
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
					}
					return ;
				}
			}
		}
	
		public function telaAdicionarAcatracaVirtual(){
	
			$dao = new DAO();
			$this-&gt;view-&gt;formAdicionarCatracaVirtual();

			if(isset($_POST['nome_catraca'])){
				
				$nomeCatraca = $_POST['nome_catraca'];
				$sql1 = &quot;SELECT * FROM catraca WHERE catr_nome = '$nomeCatraca'&quot;;
				$result = $dao-&gt;getConexao()-&gt;query($sql1);
				$i = 0;
					
				foreach ($result as $linha){
					$i++;
				}
					
				if($i &gt; 0){
					$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Esta catraca j&aacute; existe!&quot;);
					echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
				}else{
					if(isset($_POST['confirmar'])){
						$sql = &quot;INSERT INTO catraca (catr_nome) VALUES ('$nomeCatraca')&quot;;
						if($dao-&gt;getConexao()-&gt;exec($sql)){
							echo'&lt;div class=&quot;borda&quot;&gt;';
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Catraca adicionada com Sucesso!&quot;);
							echo '&lt;/div&gt;';
						}else{
							echo'&lt;div class=&quot;borda&quot;&gt;';
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;N&atilde;o foi poss&iacute;vel adicionar a catraca!&quot;);
							echo '&lt;/div&gt;';
						}
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						return ;
					}
	
					echo '&lt;div class=&quot;borda&quot;&gt;';
					$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Tem certeza que deseja adicionar esta catraca?&quot;);
					echo '&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
						&lt;input type=&quot;hidden&quot; value=&quot;'.$_POST['nome_catraca'].'&quot; name=&quot;nome_catraca&quot;&gt;
						&lt;input type=&quot;submit&quot; class=&quot;botao&quot; value=&quot;Confirmar&quot; name=&quot;confirmar&quot; /&gt;
						&lt;/form&gt;';
					echo '&lt;/div&gt;';
				}
			}
			return ;
		}
	
		public function telaMensagem(){
	
			$unidade = new Unidade();
			$unidadeDao = new UnidadeDAO();
			$unidades = $unidadeDao-&gt;retornaLista();
	
			echo '	&lt;h2 class=&quot;titulo&quot;&gt;Incluir e Editar Mensagens da Catraca&lt;/h2&gt;
				&lt;div class=&quot;borda doze colunas&quot;&gt;
					&lt;form action=&quot;&quot; class=&quot;formulario-organizado&quot; method=&quot;&quot;&gt;
						&lt;input type=&quot;hidden&quot; name=&quot;pagina&quot; value=&quot;definicoes&quot;&gt;
						&lt;label for=&quot;&quot;&gt;
							&lt;object class=&quot;rotulo&quot;&gt;Unidade Acad&ecirc;mica: &lt;/object&gt;
							&lt;select name=&quot;unidade&quot; id=&quot;unidade&quot;&gt;';
			echo'				&lt;option&gt;Selecione uma Unidade&lt;/option&gt;';
			foreach ($unidades as $unidade){
				echo'			&lt;option value=&quot;'.$unidade-&gt;getId().'&quot;&gt;'.$unidade-&gt;getNome().'&lt;/option&gt;';
			}
			echo '
							&lt;/select&gt;
						&lt;/label&gt;';
	
			echo '	&lt;label for=&quot;&quot;&gt;
					&lt;object class=&quot;rotulo&quot;&gt;Catraca: &lt;/object&gt;
					&lt;select id=&quot;catraca&quot; name=&quot;catraca&quot;&gt;
						&lt;option&gt;Selecione uma Catraca&lt;/option&gt;
					&lt;/select&gt;
				&lt;/label&gt;
				&lt;input type=&quot;submit&quot; value=&quot;Buscar&quot;&gt;
			&lt;/form&gt;
			&lt;div id=&quot;mensagens&quot;&gt;';
	
			if (isset($_GET['unidade'])){
				
				if(intval($_GET['catraca']) &amp;&amp; intval($_GET['unidade'])){
					
					$idCatraca = $_GET['catraca'];
					$idUnidade = $_GET['unidade'];
					$dao = new DAO();
					$view = new DefinicoesView();
						
					$sql = &quot;SELECT * FROM catraca
					INNER JOIN catraca_unidade ON catraca_unidade.catr_id = catraca.catr_id
					INNER JOIN unidade ON unidade.unid_id = catraca_unidade.unid_id
					WHERE unidade.unid_id = $idUnidade AND catraca.catr_id = $idCatraca&quot;;
					$result = $dao-&gt;getConexao()-&gt;query($sql);
					foreach ($result as $linha){
						$nomeCatraca = $linha['catr_nome'];
						$nomeUnidade = $linha['unid_nome'];
					}
						
					$sql = &quot;SELECT * FROM mensagem
					INNER JOIN catraca_unidade ON catraca_unidade.catr_id = mensagem.catr_id
					INNER JOIN unidade ON unidade.unid_id = catraca_unidade.unid_id
					INNER JOIN catraca ON catraca_unidade.catr_id = catraca.catr_id
					WHERE mensagem.catr_id = $idCatraca&quot;;
					$result = $dao-&gt;getConexao()-&gt;query($sql);
					foreach ($result as $linha){
						$msg1 = $linha['mens_institucional1'];
						$msg2 = $linha['mens_institucional2'];
						$msg3 = $linha['mens_institucional3'];
						$msg4 = $linha['mens_institucional4'];
						$nomeUnidade = $linha['unid_nome'];
						$nomeCatraca = $linha['catr_nome'];
					}
					$args = array($nomeUnidade, $nomeCatraca, @$msg1, @$msg2, @$msg3, @$msg4);
					$view-&gt;formEditarMensagensCatraca($args);
				
				}
			}
			echo '&lt;/div&gt;';
	
			if (isset($_GET['salvar'])){
				if (isset($_POST['confirmar'])){
					$msg1 = $_GET['msg_um'];
					$msg2 = $_GET['msg_dois'];
					$msg3 = $_GET['msg_tres'];
					$msg4 = $_GET['msg_quatro'];
					$id_catraca = $_GET['id_catraca'];
					$i = 0;
					$result = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * FROM mensagem WHERE catr_id = $id_catraca&quot;);
					foreach ($result as $linha){
						$i++;
					}
					if ($i == 0){
						$sql = &quot;INSERT INTO mensagem (
						mens_institucional1, mens_institucional2, mens_institucional3, mens_institucional4, catr_id)
						VALUES ('$msg1','$msg2','$msg3','$msg4',$id_catraca)&quot;;
						if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Mensagem inserida com sucesso!&quot;);
							echo '&lt;/div&gt;';
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
							return ;
						}else{
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao inserir mensagem!&quot;);
							echo '&lt;/div&gt;';
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
							return ;
						}
					}else {
						$sql = &quot;UPDATE mensagem SET
						mens_institucional1 = '$msg1',
						mens_institucional2 = '$msg2',
						mens_institucional3 = '$msg3',
						mens_institucional4 = '$msg4'
						WHERE catr_id = $id_catraca&quot;;
						if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
							$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Mensagem atualizada com sucesso!&quot;);
							echo '&lt;/div&gt;';
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
							return ;
						}else{
							$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao atualizar mensagem!&quot;);
							echo '&lt;/div&gt;';
							echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
							return ;
						}
					}
				}
				$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Deseja incluir estas mensagens?&quot;);
				echo'	&lt;form class=&quot;formulario-organizado&quot; method=&quot;post&quot;&gt;
						&lt;input type=&quot;submit&quot; name=&quot;confirmar&quot; value=&quot;Confirmar&quot;&gt;
					&lt;/form&gt;';
			}
	
			$sql = &quot;SELECT * FROM unidade
				INNER JOIN catraca_unidade ON catraca_unidade.unid_id = unidade.unid_id
				INNER JOIN catraca ON catraca.catr_id = catraca_unidade.catr_id
				INNER JOIN mensagem ON catraca.catr_id = mensagem.catr_id&quot;;
			$listaMensagemCatraca = $this-&gt;dao-&gt;getConexao()-&gt;query($sql);
			$this-&gt;view-&gt;listarMensagensCatraca($listaMensagemCatraca);
	
			if (isset($_GET['excluir'])){
				echo '&lt;hr class=&quot;um&quot;&gt;';
				$this-&gt;view-&gt;formMensagem(&quot;-ajuda&quot;, &quot;Deseja realmente excluir estas mensagens?&quot;);
				echo '	&lt;form class=&quot;formulario&quot; method=&quot;post&quot;&gt;
						&lt;input type=&quot;submit&quot; name=&quot;confirma&quot; value=&quot;Confirmar&quot;&gt;
					&lt;/form&gt;';
				if (isset($_POST['confirma'])){
					$id_catraca = $_GET['id-catraca'];
					$sql = &quot;DELETE FROM mensagem WHERE catr_id = $id_catraca&quot;;
					if ($this-&gt;dao-&gt;getConexao()-&gt;exec($sql)){
						$this-&gt;view-&gt;formMensagem(&quot;-sucesso&quot;, &quot;Mensagem exclu&iacute;da com sucesso!&quot;);
						echo '&lt;/div&gt;';
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						return ;
					}else{
						$this-&gt;view-&gt;formMensagem(&quot;-erro&quot;, &quot;Erro ao exluir a mensagem!&quot;);
						echo '&lt;/div&gt;';
						echo '&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2; url=.\?pagina=definicoes&quot;&gt;';
						return ;
					}
				}
			}
			echo '		&lt;/div&gt;';
		}
	
		public function telaDefinicoes() {
			$this-&gt;dao = new DAO ();
			$this-&gt;view = new DefinicoesView ();
	
			$selecaoUnidade = &quot;active&quot;;
			$selecaoTurnos = &quot;&quot;;
			$selecaoTipos = &quot;&quot;;
			$selecaoCustos = &quot;&quot;;
			$selecaoCatracas = &quot;&quot;;
			if (isset ( $_GET ['cadastrar_unidade'] ) || isset ( $_POST ['certeza_cadastrar_unidade'] )) {
				$selecaoUnidade = &quot;active&quot;;
				$selecaoTurnos = &quot;&quot;;
				$selecaoTipos = &quot;&quot;;
				$selecaoCatracas = &quot;&quot;;
				$selecaoCustos = &quot;&quot;;
			} else if (isset ( $_POST ['certeza_cadastrar_turno'] ) || isset ( $_GET ['cadastrar_turno'] )) {
				$selecaoUnidade = &quot;&quot;;
				$selecaoTurnos = &quot;active&quot;;
				$selecaoTipos = &quot;&quot;;
				$selecaoCatracas = &quot;&quot;;
				$selecaoCustos = &quot;&quot;;
			} else if (isset ( $_GET ['cadastrar_tipo'] ) || isset ( $_POST ['certeza_cadastrar_tipo'] )) {
				$selecaoUnidade = &quot;&quot;;
				$selecaoTurnos = &quot;&quot;;
				$selecaoCatracas = &quot;&quot;;
				$selecaoTipos = &quot;active&quot;;
				$selecaoCustos = &quot;&quot;;
			} else if (isset ( $_GET ['custo_cartao'] ) || isset ( $_GET ['custo_refeicao'] )) {
				$selecaoUnidade = &quot;&quot;;
				$selecaoTurnos = &quot;&quot;;
				$selecaoCatracas = &quot;&quot;;
				$selecaoTipos = &quot;&quot;;
				$selecaoCustos = &quot;active&quot;;
			} else if(isset($_GET['editar_catraca']) || isset($_GET['lista_catracas'])){
				$selecaoUnidade = &quot;&quot;;
				$selecaoTurnos = &quot;&quot;;
				$selecaoCatracas = &quot;active&quot;;
				$selecaoTipos = &quot;&quot;;
				$selecaoCustos = &quot;&quot;;
			}
	
			echo '&lt;div class=&quot;navegacao&quot;&gt;
				&lt;div class = &quot;simpleTabs&quot;&gt;
			        &lt;ul class = &quot;simpleTabsNavigation&quot;&gt;
			            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Unidades Acad&ecirc;micas&lt;/a&gt;&lt;/li&gt;
						&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Turnos&lt;/a&gt;&lt;/li&gt;
						&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Catracas&lt;/a&gt;&lt;/li&gt;
						&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Tipos de Usu&aacute;rios&lt;/a&gt;&lt;/li&gt;
						&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Mensagens Catraca&lt;/a&gt;&lt;/li&gt;
						&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Custos&lt;/a&gt;&lt;/li&gt;
			        &lt;/ul&gt;
	
					&lt;div class = &quot;simpleTabsContent&quot;&gt; ';
			$this-&gt;telaConfiguracaoUnidadeAcademica ();
	
			echo '  	&lt;/div&gt;
		        	&lt;div class = &quot;simpleTabsContent&quot;&gt;';
	
			$this-&gt;telaConfiguracaoDeTurnos ();
	
			echo '  	&lt;/div&gt;
		        	&lt;div class = &quot;simpleTabsContent&quot;&gt;';
	
			$this-&gt;telaCatracas();
	
			echo '  	&lt;/div&gt;
		        	&lt;div class = &quot;simpleTabsContent&quot;&gt;';
	
			$this-&gt;telaTiposDeUsuarios ();
	
			echo '  	&lt;/div&gt;
		  			&lt;div class = &quot;simpleTabsContent&quot;&gt;';
	
			$this-&gt;telaMensagem();
	
			echo '  	&lt;/div&gt;
		  			&lt;div class = &quot;simpleTabsContent&quot;&gt;';
	
			$this-&gt;telaDeCustos();
	
			echo '		&lt;/div&gt;
		  		&lt;/div&gt;
			  &lt;/div&gt;';
	
		}
	}
	
	?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>