<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Classe utilizada para centralizar as demais Classes(DAO, Model, View, Util).
 * Esta classe ser&aacute; instaciada no index.php.
 * 
 * @author Jefferson Uchoa Ponte
 * @version 1.0
 * @copyright UNILAB - Universidade da Integracao Internacional da Lusofonia Afro-Brasileira.
 * @package Controle
 */

class RelatorioControllerGuiche {
	
	/**
	 * Metodo principal utilizada para controlar o acesso a classe atrav&eacute;s do n&iacute;vel de acesso do usuario.
	 *
	 * @param Sessao $nivelDeAcesso Recebe uma Sess&atilde;o que cont&eacute;m o n&iacute;vel de acesso do usuario,
	 * esta Sess&atilde;o &eacute; iniciada na p&aacute;gina principal, durante o login do usuario.
	 */
	public static function main($nivel) {
		switch ($nivel) {
			case Sessao::NIVEL_SUPER :
				$relatorio = new RelatorioControllerGuiche ();
				$relatorio-&gt;relatorioGuiche ();
				break;
			case Sessao::NIVEL_ADMIN :
				$relatorio = new RelatorioControllerGuiche ();
				$relatorio-&gt;relatorioGuiche ();				
				break;
			default :
				UsuarioController::main ( $nivel );
				break;
		}
	}
	
	/**
	 * Gera um relat&oacute;rio contendo as informa&ccedil;&otilde;es das transa&ccedil;&otilde;es realizadas pelos operadores.
	 * Realiza uma consulta na tabela transacao e soma todos os valores retornados.
	 * 
	 * Pode ser realizado um filtro por operador e data.
	 * 
	 */
	public function relatorioGuiche() {
		$dao = new DAO ();
		$usuarioDao = new UsuarioDAO ();
		$usuario = new Usuario ();
		$relatorioGuiche = new RelatorioControllerGuiche ();
		
		echo '	&lt;div class=&quot;borda relatorio&quot;&gt;
					&lt;form action=&quot;&quot; method=&quot;get&quot; class=&quot;formulario-organizado&quot;&gt;
						&lt;label for=&quot;operador&quot;&gt;
							&lt;object data=&quot;&quot; type=&quot;&quot; class=&quot;rotulo&quot;&gt;Operador:&lt;/object&gt;
							&lt;select name=&quot;operador&quot; id=&quot;operador&quot;&gt;';
		
		$sql = &quot;SELECT * FROM usuario WHERE usua_nivel &gt; 1&quot;;
		$result = $dao-&gt;getConexao ()-&gt;query ( $sql );
		foreach ( $result as $linha ) {			
			echo '
						&lt;option value=&quot;' . $linha ['usua_id'] . '&quot;&gt;' . ucwords ( strtolower ( htmlentities ( $linha ['usua_nome'] ) ) ) . '&lt;/option&gt;';
		}
		
		echo '			&lt;option value=&quot;&quot; selected&gt;Todos os Operadores&lt;/option&gt;	
						&lt;/select&gt;
						&lt;/label&gt;&lt;br&gt;
						&lt;label for=&quot;data_inicio&quot;&gt;
							Data Inicio: &lt;input type=&quot;datetime-local&quot; name=&quot;data_inicio&quot;&gt;
						&lt;/label&gt;&lt;br&gt;
						&lt;label for=&quot;data_fim&quot;&gt;
							Data Fim: &lt;input type=&quot;datetime-local&quot; name=&quot;data_fim&quot;&gt;
						&lt;/label&gt;&lt;br&gt;
						&lt;input type=&quot;hidden&quot; value=&quot;relatorio_guiche&quot; name=&quot;pagina&quot;&gt;				
						&lt;input type=&quot;submit&quot; value=&quot;Gerar&quot; name=&quot;gerar&quot;&gt;				
					&lt;/form&gt;
				&lt;/div&gt;';
		
		if (isset ( $_GET ['gerar'] )) {
			
			$dataInicio = date ( $_GET ['data_inicio'] );
			$dataFim = date ( $_GET ['data_fim'] );
			$idDoUsuario = ($_GET ['operador']);
			
			if ($dataInicio == null) {
				$dataInicio = date ( 'Y-m-d' ).' 00:00:00';
			}
			if ($dataFim == null) {
				$dataFim = date ( 'Y-m-d' ).' 23:59:59';
			}
			
			$operador = &quot;&quot;;
			if ($idDoUsuario != null) {
				$operador = &quot;AND usuario.usua_id = $idDoUsuario&quot;;
			}
			
			echo '	&lt;div class=&quot;borda relatorio&quot;&gt;
				&lt;h2&gt;UNILAB&lt;small class=&quot;fim&quot;&gt;Universidade da Integra&ccedil;&atilde;o Internacional da Lusofonia Afro-Brasileira&lt;/small&gt;&lt;/h2&gt;
				&lt;hr class=&quot;um&quot;&gt;	
				&lt;table class=&quot;tabela-relatorio&quot;&gt;
						&lt;thead&gt;
							&lt;tr&gt;
								&lt;th&gt;Data&lt;/th&gt;
								&lt;th&gt;Hora&lt;/th&gt;								
								&lt;th&gt;Descri&ccedil;&atilde;o&lt;/th&gt;
								&lt;th&gt;Operador&lt;/th&gt;
								&lt;th&gt;Valor&lt;/th&gt;
							&lt;/tr&gt;
						&lt;/thead&gt;
						&lt;tbody&gt;';
			
			$inicio = date(&quot;Y-m-d H:i:s&quot;, strtotime($dataInicio));
			$fim = date(&quot;Y-m-d H:i:s&quot;, strtotime($dataFim));
			
			$valorTotal = 0;
						
			$sqlTran = &quot;SELECT * FROM transacao as trans 
					LEFT JOIN usuario as usuario
					on trans.usua_id = usuario.usua_id 
					WHERE (tran_data BETWEEN '$inicio' AND '$fim') $operador &quot;;
			$result = $dao-&gt;getConexao ()-&gt;query ( $sqlTran );
			foreach ( $result as $dado ) {
				echo '	&lt;tr&gt;
							&lt;td&gt;' . date ( &quot;d/m/Y&quot;, strtotime ( $dado ['tran_data'] ) ) . '&lt;/td&gt;
							&lt;td&gt;' . date ( 'H:i:s', strtotime ( $dado ['tran_data'] ) ) . '&lt;/td&gt;						
							&lt;td&gt;' . $dado ['tran_descricao'] . '&lt;/td&gt;
							&lt;td&gt;' . $dado ['usua_nome'] . '&lt;/td&gt;	
							&lt;td&gt;R$ ' . $dado ['tran_valor'] .' - ID:'.$dado['usua_id1'].'&lt;/td&gt;
						&lt;/tr&gt;';
			}
			
			$result = $dao-&gt;getConexao ()-&gt;query ( $sqlTran );
			foreach ( $result as $linha ) {
				$valor = $linha ['tran_valor'];
				floatval ( $valor );
				if ($linha) {
					$valorTotal = $valorTotal + $valor;
				}
			}
			
			echo '		&lt;tr id=&quot;soma&quot;&gt;
							&lt;th&gt;Somat&oacute;rio&lt;/th&gt;							
							&lt;td&gt; - &lt;/td&gt;
							&lt;td&gt; - &lt;/td&gt;
							&lt;td&gt; - &lt;/td&gt;
							&lt;td&gt;R$ ' . number_format ( $valorTotal, 2 ) . '&lt;/td&gt;
						&lt;/tr&gt;					
					&lt;/tbody&gt;
				&lt;/table&gt;
			&lt;/div&gt;';
		}
	}
}

?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>