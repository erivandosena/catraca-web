<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Classe utilizada para centralizar as demais Classes(DAO, Model, View, Util).
 * Esta classe ser&aacute; instaciada no index.php.
 * 
 * @author Jefferson Uchoa Ponte
 * @version 1.0
 * @copyright UNILAB - Universidade da Integracao Internacional da Lusofonia Afro-Brasileira.
 * @package Controle
 */

class InfoController{
	
	/**
	 * 
	 * @var unknown
	 */
	private $view;
	
	/**
	 * Fun&ccedil;&atilde;o principal utilizada para controlar o acesso a classe atrav&eacute;s do n&iacute;vel de acesso do usuario.
	 *
	 * @param Sessao $nivelDeAcesso
	 *        	Recebe uma Sess&atilde;o que cont&eacute;m o n&iacute;vel de acesso do usuario,
	 *        	esta Sess&atilde;o &eacute; iniciada na p&aacute;gina principal, durante o login do usuario.
	 */
	public static function main($nivelDeAcesso){
	
		switch ($nivelDeAcesso){
			case Sessao::NIVEL_SUPER:
				$controller = new InfoController();
				$controller-&gt;telaInfo();
				break;
			case Sessao::NIVEL_ADMIN:
				$controller = new InfoController();
				$controller-&gt;telaInfo();
				break;
			case Sessao::NIVEL_GUICHE:
				$controller = new InfoController();
				$controller-&gt;telaInfo();
				break;
			case Sessao::NIVEL_CADASTRO:
				$controller = new InfoController();
				$controller-&gt;telaInfo();
				break;
			case Sessao::NIVEL_CATRACA_VIRTUAL:
				$controller = new InfoController();
				$controller-&gt;telaInfo();
				break;
			default:
				UsuarioController::main ( $nivelDeAcesso );
				break;
		}
	
	
	}	
	
	public function telaInfo(){
		
		echo '&lt;div class=&quot;conteudo&quot;&gt; &lt;div class = &quot;simpleTabs&quot;&gt;
		        &lt;ul class = &quot;simpleTabsNavigation&quot;&gt;
		
					&lt;li&gt;&lt;a href=&quot;#&quot;&gt;Informa&ccedil;&otilde;es&lt;/a&gt;&lt;/li&gt;

			
		        &lt;/ul&gt;
		        &lt;div class = &quot;simpleTabsContent&quot;&gt;';
		
		$this-&gt;mostrarDados();
		echo '	&lt;/div&gt;
		
		
		    &lt;/div&gt;&lt;/div&gt;';
		
	}
	
	public function mostrarDados(){

		
		
		
		
		$dao = new DAO();
		
		//Total de cart&otilde;es cadastrados.
		$sql = &quot;SELECT sum(1) as soma FROM cartao&quot;;

		$result = $dao-&gt;getConexao()-&gt;query($sql);
		foreach($result as $linha){
			
			echo '&lt;p&gt;Cart&otilde;es Cadastrados ' .$linha['soma'].'&lt;/p&gt;';
				
		}
		
		
		//Total de cart&otilde;es cadastrados n&atilde;o avulsos.
		$sql = &quot;SELECT sum(1) as soma FROM cartao INNER JOIN vinculo ON cartao.cart_id = vinculo.cart_id 
				WHERE vinculo.vinc_avulso = 'FALSE'&quot;;
		
		$result = $dao-&gt;getConexao()-&gt;query($sql);
		foreach($result as $linha){
			$cadastradosProprios = $linha['soma'];
			echo '&lt;p&gt;Cart&otilde;es n&atilde;o avulsos ' .$linha['soma'].'&lt;/p&gt;';
		
		}
		
		//Total de cart&otilde;es com vinculo ativo. 
		$dataTimeAtual = date ( &quot;Y-m-d G:i:s&quot; );
		$sql =  &quot;SELECT sum(1) as soma FROM usuario INNER JOIN vinculo
		ON vinculo.usua_id = usuario.usua_id
		LEFT JOIN cartao ON cartao.cart_id = vinculo.cart_id
		LEFT JOIN tipo ON cartao.tipo_id = tipo.tipo_id
		WHERE '$dataTimeAtual' BETWEEN vinc_inicio AND vinc_fim&quot;;
		
		

		$result = $dao-&gt;getConexao()-&gt;query($sql);
		foreach($result as $linha){
		
			echo '&lt;p&gt;Cart&otilde;es com validade ativa ' .$linha['soma'].'&lt;/p&gt;';
		
		}
		
		//Total de cart&otilde;es com vinculo ativo Pr&oacute;prios. 
		$dataTimeAtual = date ( &quot;Y-m-d G:i:s&quot; );
		$sql =  &quot;SELECT sum(1) as soma FROM usuario INNER JOIN vinculo
		ON vinculo.usua_id = usuario.usua_id
		LEFT JOIN cartao ON cartao.cart_id = vinculo.cart_id
		LEFT JOIN tipo ON cartao.tipo_id = tipo.tipo_id
		WHERE '$dataTimeAtual' BETWEEN vinc_inicio AND vinc_fim AND vinc_avulso = 'FALSE'&quot;;
		
	
		$result = $dao-&gt;getConexao()-&gt;query($sql);
		foreach($result as $linha){
		
			echo '&lt;p&gt;Cart&otilde;es pr&oacute;prios com validade ativa ' .$linha['soma'].'&lt;/p&gt;';
		
		}
		

		$sql =  &quot;SELECT cart_id FROM registro GROUP BY cart_id&quot;;
		
		
		$result = $dao-&gt;getConexao()-&gt;query($sql);
		$i = 0;
		foreach($result as $linha){
			$i++;
			
		}
		
		echo '&lt;p&gt;Cart&otilde;es usados pelo menos uma vez no RU: ' .$i.'&lt;/p&gt;';
		echo '&lt;p&gt;Cart&otilde;es pr&oacute;prios que nunca foram utilizados:'.($cadastradosProprios-$i).' &lt;/p&gt;';
		
	}
		
		
	
	
}

?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>