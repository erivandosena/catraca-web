<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Classe utilizada para centralizar as demais Classes(DAO, Model, View, Util).
 * Esta classe ser&aacute; instaciada no index.php.
 * 
 * @author Jefferson Uchoa Ponte
 * @version 1.0
 * @copyright UNILAB - Universidade da Integracao Internacional da Lusofonia Afro-Brasileira.
 * @package Controle
 */
/**
 * 
 * 
 *
 */
class RelatorioAvulsoProprio{
	
	/**
	 * Recebe um Objeto DAO.
	 * 
	 * @var DAO
	 */
	private $dao;
	
	/**
	 * 
	 */
	public function start(){
		echo '
		Fiscaliza&amp;ccedil;&amp;atilde;o
		&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;			
			&lt;input type=&quot;date&quot; name=&quot;data&quot; /&gt;
			&lt;input type=&quot;submit&quot;/&gt;
		&lt;/form&gt;';
		if(isset($_GET['data']))
			$this-&gt;mostrarFiscal($_GET['data']);
	}
	
	/**
	 * 
	 * @param DateTime $data
	 */
	public function mostrarFiscal($data){
		$time = strtotime($data);
		echo 'Dados do dia '.date(&quot;d/m/Y&quot;, $time);
		$this-&gt;dao = new DAO();
		
		$hora1 = date('Y-m-d', $time).' 08:00:00';
		$hora2 = date('Y-m-d', $time).' 15:00:00';
		
		$registroAlmoco = $this-&gt;geraNumeroDeRegistros($hora1, $hora2);
		$transacaoAlmoco = $this-&gt;geraNumeroDeTransacoes($hora1, $hora2);
		$dinheiroAlmoco = $this-&gt;geraValoresEmCaixa($hora1, $hora2);
		$avulsosAlmoco = $this-&gt;geraNumeroDeRegistrosAvulsos($hora1, $hora2);


				
		$hora1 = date('Y-m-d', $time).' 15:00:00';
		$hora2 = date('Y-m-d', $time).' 22:00:00';
		
		$registroJantar = $this-&gt;geraNumeroDeRegistros($hora1, $hora2);
		$transacaoJantar = $this-&gt;geraNumeroDeTransacoes($hora1, $hora2);
		$dinheiroJantar = $this-&gt;geraValoresEmCaixa($hora1, $hora2);
		$avulsosJantar = $this-&gt;geraNumeroDeRegistrosAvulsos($hora1, $hora2);
		
		echo '&lt;table border=&quot;1&quot;&gt;
			&lt;tr&gt;&lt;th&gt;Almoco&lt;/th&gt;&lt;/tr&gt;
				&lt;tr&gt;&lt;td&gt;Catraca Virtual: '.$registroAlmoco.'&lt;/td&gt;&lt;/tr&gt;		

				&lt;tr&gt;&lt;td&gt;Catraca Avulsos: '.$avulsosAlmoco.'&lt;/td&gt;&lt;/tr&gt;		

				&lt;tr&gt;&lt;td&gt;Transacoes Guiche: '.$transacaoAlmoco .'&lt;/td&gt;&lt;/tr&gt;
				&lt;tr&gt;&lt;td&gt;Transacoes Guiche: '.$dinheiroAlmoco .'&lt;/td&gt;&lt;/tr&gt;		
			&lt;/table&gt;';
		
		echo '&lt;table border=&quot;1&quot;&gt;
			&lt;tr&gt;&lt;th&gt;Jantar&lt;/th&gt;&lt;/tr&gt;
				&lt;tr&gt;&lt;td&gt;Catraca Virtual: '.$registroJantar.'&lt;/td&gt;&lt;/tr&gt;		
				&lt;tr&gt;&lt;td&gt;Catraca Avulsos: '.$avulsosJantar.'&lt;/td&gt;&lt;/tr&gt;		


				&lt;tr&gt;&lt;td&gt;Transacoes Guiche: '.$transacaoJantar .'&lt;/td&gt;&lt;/tr&gt;		
				&lt;tr&gt;&lt;td&gt;Transacoes Guiche: '.$dinheiroJantar .'&lt;/td&gt;&lt;/tr&gt;
			&lt;/table&gt;';
	}
	
	/**
	 * 
	 * @param DateTime $data1
	 * @param DateTime $data2
	 */
	public function geraNumeroDeRegistros($data1, $data2){
		$result = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * From registro
		WHERE regi_data BETWEEN '$data1' AND '$data2';
			&quot;);
		$i = 0;
		foreach($result as $linha){
			$i++;
		}
		return $i;
	}
	
	/**
	 * 
	 * @param DateTime $data1
	 * @param DateTime $data2
	 */
	public function geraNumeroDeRegistrosAvulsos($data1, $data2){
		$result = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * From registro
		INNER JOIN vinculo ON vinculo.vinc_id = registro.vinc_id
		WHERE regi_data BETWEEN '$data1' AND '$data2';
			&quot;);
		$i = 0;
		foreach($result as $linha){
			if($linha['vinc_avulso'])
				$i++;
		}
		return $i;
	}

	/**
	 * 
	 * @param DateTime $data1
	 * @param DateTime $data2
	 */
	public function geraNumeroDeTransacoes($data1, $data2){
		$result = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * From transacao
		WHERE tran_data BETWEEN '$data1' AND '$data2';
			&quot;);
		$i = 0;
		foreach($result as $linha){
			$i++;
		}
		return $i;	
	}
	
	/**
	 * 
	 * @param DateTime $data1
	 * @param DateTime $data2
	 */
	public function geraValoresEmCaixa($data1, $data2){
		$result = $this-&gt;dao-&gt;getConexao()-&gt;query(&quot;SELECT * From transacao
		WHERE tran_data BETWEEN '$data1' AND '$data2';
			&quot;);
		$i = 0.0;
		foreach($result as $linha){
			$i += $linha['tran_valor'];
		}
		return $i;	
	}

	
	



}

?&gt;
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>