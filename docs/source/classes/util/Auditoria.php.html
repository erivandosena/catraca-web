<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * @author Jefferson Uchoa Ponte
 * @version 1.0
 * @copyright UNILAB - Universidade da Integracao Internacional da Lusofonia Afro-Brasileira.
 * @package Util
 */

/**
 * Como usar
 * Para come&ccedil;ar a usar chame o metodo est&aacute;tico da seguinte forma:
 *
 * Auditoria::criarTabela(new PDO(&quot;pgsql:host=localhost dbname=nome_do_banco user=usuario_do_banco password=senhaDoBanco&quot;));
 *
 * Ap&oacute;s a tabela criada
 * Inclua a classe auditoria no arquivo PHP da pagina que deseja auditar.
 *
 * $auditoria1 = new Auditoria(new PDO(&quot;pgsql:host=localhost dbname=nome_do_banco user=usuario_do_banco password=senhaDoBanco&quot;));
 *
 * $auditoria1-&gt;cadastrar(12);//Ou $auditoria1-&gt;cadastrar(12, &quot;Alterando tabela endereco&quot;);
 */
class Auditoria {
	private $conexao;
	public function Auditoria(PDO $conexao = NULL) {
		if ($conexao != null) {
			$this-&gt;conexao = $conexao;
		} else {
			$this-&gt;conexao = new PDO ( &quot;pgsql:host=localhost dbname=nome_do_banco user=usuario_do_banco password=senhaDoBanco&quot; );
		}
	}
	public function cadastrar($idDoUsuario, $obs = &quot;-&quot;) {
		$url = $_SERVER ['REQUEST_URI'];
		$idDoUsuario = intval ( $idDoUsuario );
		$data = date ( &quot;Y-m-d H:i:s&quot; );
		$sql = &quot;INSERT INTO auditoria(audi_pagina, audi_data, usua_id, audi_observacao) VALUES('$url', '$data', $idDoUsuario, '$obs');&quot;;
		$this-&gt;conexao-&gt;exec ( $sql );
	}
	/**
	 * Caso queira criar a tabela no banco local passe uma conex&atilde;o PDO.
	 *
	 * @param PDO $conexao        	
	 */
	public static function criarTabela(PDO $conexao) {
		$conexao-&gt;exec ( &quot;CREATE TABLE auditoria(audi_id serial NOT NULL,
				audi_pagina character varying(200),audi_data timestamp without time zone,  
				usua_id integer,  audi_observacao character varying(200),  CONSTRAINT auditoria_pkey PRIMARY KEY (audi_id));&quot; );
	}
	public static function mostrar(PDO $conexao, $idUsuario = null, $dataInicial = null, $dataFinal = null) {
		$filtro = &quot;&quot;;
		if ($dataInicial != null &amp;&amp; $dataFinal != null &amp;&amp; $idUsuario != null) {
			$dataInicial = date ( &quot;Y-m-d :h:i:s&quot;, strtotime ( $dataInicial ) );
			$dataFinal = date ( &quot;Y-m-d H:i:s&quot;, strtotime ( $dataFinal ) );
			$idUsuario = intval ( $idUsuario );
			$filtro = &quot;Where auditoria.usua_id = $idUsuario AND audi_data Between '$dataInicial' AND '$dataFinal'&quot;;
		}
		$sql = &quot;SELECT * FROM auditoria 
				INNER JOIN usuario 
				ON auditoria.usua_id = usuario.usua_id $filtro
				ORDER BY audi_id DESC LIMIT 3000&quot;;
		
		$result = $conexao-&gt;query ( $sql );
		echo '&lt;table border=&quot;1&quot;&gt;';
		echo '&lt;tr&gt;&lt;th&gt;Nome&lt;/th&gt;&lt;th&gt;Pagina&lt;/th&gt;&lt;th&gt;Data e Hora&lt;/th&gt;&lt;th&gt;Nivel de Acesso&lt;/th&gt;&lt;/tr&gt;';
		foreach ( $result as $linha ) {
			echo '&lt;tr&gt;&lt;td&gt;' . $linha ['usua_nome'] . '&lt;/td&gt;&lt;td&gt;' . $linha ['audi_pagina'] . '&lt;/td&gt;&lt;td&gt;' . date ( &quot;d/m/Y H:i:s&quot;, strtotime ( $linha ['audi_data'] ) ) . '&lt;/td&gt;&lt;td&gt;' . $linha ['usua_nivel'] . '&lt;/td&gt;&lt;/tr&gt;';
		}
		echo '&lt;/table&gt;';
	}
}

?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>